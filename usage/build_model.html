
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Model building &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kubeflow pipeline" href="kubeflow_pipeline.html" />
    <link rel="prev" title="Feature selection" href="feature_selection.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="model-building">
<h1>Model building<a class="headerlink" href="#model-building" title="Permalink to this headline">¶</a></h1>
<p>In order to build the surrogate model, output generated during preprocessing and feature selection are used as inputs. The surrogate model is developed using neural network with Multi-layer perceptron (MLP) in Keras.</p>
<section id="hyperparameter-search">
<h2>Hyperparameter Search<a class="headerlink" href="#hyperparameter-search" title="Permalink to this headline">¶</a></h2>
<p>There are two options when building the model: (1) with hyperparameter search, and (2) without hyperparameter search.
Hyperparameter search is controlled by the <code class="docutils literal notranslate"><span class="pre">--param_search</span></code> switch on.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The time taken for the hyperparameter search to be completed will be dependent on the number of parameters searched for , the number of options provided for each parameter search and the size of the dataset. Where possible, its advisable to keep the search parameter and options concise.</p>
</div>
<p>The following are the various types of hyperparameters searched for and their values:</p>
<ul class="simple">
<li><p>activation: The options are ‘relu’,’tanh’, or ‘sigmoid’. Other activation functions for neural nets can also be applied, the most optimal activation function for the surrogate model are currently considered.</p></li>
<li><p>regularizers: The options are 1e-1, 1e-3, 1e-4, 1e-5. However to control the hyparameter search time, the current options explored are 1e-4, and 1e-5</p></li>
<li><p>num of layers: This parameter determines how DEEP  the neural network would be. Any numerical value can be specified here as option, however, from several iterations, it is observed that a depth of 1 provides the optimal result.</p></li>
<li><p>units: This is the number of units in each layer of the network. Numerical value can be provided here. From results from various iterations, a range of 8 to 100 at the most should be explored.</p></li>
<li><p>dropout_rate: The options specified here should be less than 1, below are the current options considered 0.1, 0.2, 0.3. More values could be included if necessary.</p></li>
<li><p>optimizer: The options are rmsprop’, ‘adam’, ‘sgd’. Other optimizers for neural nets can also be considered, the most optimal optimisers for the surrogate model are currently considered.</p></li>
</ul>
<p>As a rule of thumb, before opting to choose the option of setting the param_search to no, it is advisable to have run an hyperparameter search at least once. Once the hyperparameter search is completed, the best values will be passed to build the surrogate model. When the model is run without the hyperparameter search, the best parameter known from the hyperparameter search can be inputted for each respective field while calling the create_model function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The best parameter values will usually be displayed in the terminal when hyperparameter search is completed, otherwise, the search results generated can also be viewed from ../output/parameter_search/btap/</p>
</div>
<p>Specifically, the following are the input parameters required at to run the predict.py:</p>
<ul class="simple">
<li><p>in_obj_name: minio locationa and name of data file to be read, ideally the output file generated from preprocessing i.e. preprocessing_out.</p></li>
<li><p>features: minio locationa and name of data file to be read, ideally the output file generated from feature selection i.e. feature_out.</p></li>
<li><p>param_search: This parameter is used to determine if hyperparameter search can be performed or not, accepted value is yes or no.</p></li>
<li><p>output_path’: The minio location and filename where the output file should be written.</p></li>
</ul>
<p>Without hyperparameter search:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">predict</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">param_search</span> <span class="n">no</span> <span class="o">--</span><span class="n">in_obj_name</span> <span class="n">output_data</span><span class="o">/</span><span class="n">preprocessing_out</span> <span class="o">--</span><span class="n">features</span> <span class="n">output_data</span><span class="o">/</span><span class="n">feature_out</span> <span class="o">--</span><span class="n">output_path</span> <span class="n">output_data</span><span class="o">/</span><span class="n">predict_out</span>
</pre></div>
</div>
<p>With hyperparameter search:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">predict</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">param_search</span> <span class="n">yes</span> <span class="o">--</span><span class="n">in_obj_name</span> <span class="n">output_data</span><span class="o">/</span><span class="n">preprocessing_out</span> <span class="o">--</span><span class="n">features</span> <span class="n">output_data</span><span class="o">/</span><span class="n">feature_out</span> <span class="o">--</span><span class="n">output_path</span> <span class="n">output_data</span><span class="o">/</span><span class="n">predict_out</span>
</pre></div>
</div>
</section>
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h2>
<p>The model is trained using the training set, and the model is evaluated using the test set and the validation set generated during preprocessing. The output from the model predicts the daily energy consumption, which can be aggregated for each datapoint_id to derive the annual energy consumed. Since the daily energy consumed is in Mega Joules per meter square (mj_per_m_sq), it is converted to Giga Joules per meter square (gj_per_m_sq) which is the unit the target variable (net_site_eui_gj_per_m_sq) is represented.</p>
<p>The model is first evaluated by comparing the predicted daily energy with actual daily energy which was aggregated from the hourly energy file for each datapoint_id. Next, the predicted annaul energy and the actual energy (net_site_eui_gj_per_m_sq) is evaluated. The following metrics are used in evaluating the model:</p>
<ul class="simple">
<li><p>Mean Absolute Error (mae)</p></li>
<li><p>Mean Squared Error (mse)</p></li>
<li><p>Root Mean Squared Error (mape)</p></li>
</ul>
<p>The dictionary returned as final output from the model consist of the following key values:</p>
<ul class="simple">
<li><p>test_daily_metric: The metric for the daily energy predicted evaluation result from the test set.</p></li>
<li><p>test_annual_metric: The metric for the annual energy predicted evaluation result from the test set.</p></li>
<li><p>output_df: A dataframe containing the datapoint_id, predicted value and total energy values for the test set.</p></li>
<li><p>val_daily_metric: The metric for the daily energy predicted evaluation result from the validation set.</p></li>
<li><p>val_annual_metric: The metric for the annual energy predicted evaluation result from the validation set.</p></li>
<li><p>output_val_df: A dataframe object containing the datapoint_id, predicted value and total energy values for the validation set.</p></li>
</ul>
</section>
<section id="tensorboard">
<h2>Tensorboard<a class="headerlink" href="#tensorboard" title="Permalink to this headline">¶</a></h2>
<p>You can use the tensorboard dashboard to inspect the performance of the model.</p>
<ol class="arabic simple">
<li><p>Open <code class="docutils literal notranslate"><span class="pre">notebooks/tensorboard.ipynb</span></code>.</p></li>
<li><p>Run all the contents of the notebook.</p></li>
<li><p>Navigate to the appropriate port in a web browser.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The tensorboard opens on a random port inside your notebook container. The URL looks like
<a class="reference external" href="https://kubeflow.aaw.cloud.statcan.ca/notebook/nrcan-btap">https://kubeflow.aaw.cloud.statcan.ca/notebook/nrcan-btap</a>/&lt;notebook_name&gt;/proxy/&lt;port&gt;/.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data preparation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_prep/weather.html">Weather data processing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_selection.html">Feature selection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model building</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hyperparameter-search">Hyperparameter Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation">Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tensorboard">Tensorboard</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kubeflow_pipeline.html">Kubeflow pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plot.html">Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="feature_selection.html" title="previous chapter">Feature selection</a></li>
      <li>Next: <a href="kubeflow_pipeline.html" title="next chapter">Kubeflow pipeline</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/build_model.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>