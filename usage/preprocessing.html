
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>What this does &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>With data loaded to blob storage, run <code class="docutils literal notranslate"><span class="pre">proprocessing.py</span></code> to clean and split the data into test and train sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 preprocessing.py --in_build_params input_data/output_elec_2021-11-05.xlsx --in_hour input_data/total_hourly_res_elec_2021-11-05.csv --in_weather input_data/montreal_epw.csv --output_path output_data/preprocessing_out --in_build_params_gas input_data/output_gas_2021-11-05.xlsx --in_hour_gas input_data/total_hourly_res_gas_2021-11-05.csv
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Update the input parameters to point to the appropriate input files and ouput_path in minio. Only the filenames
would need to be changed. Check <a class="reference internal" href="../api/preprocessing.html#module-preprocessing" title="preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">preprocessing</span></code></a> for full detail description of each parameter.</p>
</div>
<p>Aside from supporting optional different files for electricity and gas, if you have mutliple input files they
need to be manually combined before passing them as input. If you only have a single input file, provide it as
the value to <code class="docutils literal notranslate"><span class="pre">--in_build_params</span></code>.</p>
<section id="what-this-does">
<h1>What this does<a class="headerlink" href="#what-this-does" title="Permalink to this headline">Â¶</a></h1>
<p>During preprocessing, the hourly energy consumption file is transposed such that each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> has 8760 rows
(365 * 24). Hence, for a simulation run containing 5000 <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code>, there would be 5000 * 8760 rows which would
be 43.8 million rows. In order to avoid the preprocessing stage to become computationally expensive due to large
datapoints created, the transposed hourly energy is is aggregated to daily energy for each datapoint_id. Similarly,
the weather information is aggregated from hourly to daily, so that it can be merged with the hourly energy file.
In essensece, the simulation I/O file(s), weather file and the hourly energy consumption file(s) are all merged to one
dataframe which then splitted for training and testing purposes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The total daily energy computed for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> is converted to Mega Joules per meter square (mj_per_m_sq),
which is derived by converting the total energy used provided in the simulation I/O file to Mega Joules and then
dividing the result by the building floor area.</p>
</div>
<p>In the case where the validation set is not provided, the dataset provided is splitted into 70% training set, 20% test
set and 10% validation set. However, when validation set is provided, the dataset is splitted only into 80% training
set and 20% test set. It should be noted that the data splitting is performed using GroupShuffleSplit function which
ensures that all data instances for a datapoint_id are included in the respective data set they are split into which
implies a datapoint_id used for training would not have any instance in the test set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file created at the end of preprocessing has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: This is all the features after data cleaning and preprocessing. Note that these are not the final features used for modelling.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: This contains the y_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_train</span></code>: This contains the X_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_test</span></code>: This contains the X_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: This contains the y_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test_complete</span></code>: This is similar to the y_test dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_validate</span></code>: This contains the X_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate</span></code>:  This contains the y_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate_complete</span></code>: This is similar to the y_validate dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
</ul>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="retrain.html">Train the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_run.html">Re-run Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubeflow_pipeline.html">Kubeflow pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plot.html">Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/preprocessing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>