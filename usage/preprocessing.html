
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>What this does &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>With the inputs specified through the command line or through <code class="docutils literal notranslate"><span class="pre">input_config.py</span></code>,
run <code class="docutils literal notranslate"><span class="pre">proprocessing.py</span></code> to clean and split the data into train, test, and validation sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Update the input parameters to point to the appropriate input files.
Check <a class="reference internal" href="../api/preprocessing.html#module-preprocessing" title="preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">preprocessing</span></code></a> for full detail description of each parameter.</p>
</div>
<p>Aside from supporting optional files for electricity and gas, if you have multiple input files to combine, they
need to be manually combined before passing them as input.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The system will not work with columns containing strings and floats together. A mix of default values which
require conversion and regular numbers must be updated to be only numbers. All data should be fully prepared before
being passed into the program.</p>
</div>
<section id="what-this-does">
<h1>What this does<a class="headerlink" href="#what-this-does" title="Permalink to this headline">Â¶</a></h1>
<p>During preprocessing, the hourly energy consumption file is transposed such that each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> has 8760 rows
(365 * 24). Hence, for a simulation run containing 5000 <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> values, there would be 5000 * 8760 rows which would
be 43.8 million rows. In order to avoid the preprocessing stage to become computationally expensive due to large
datapoints created, the transposed hourly energy file is aggregated to daily energy for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code>. Similarly,
the weather information is loaded based on which climate zones are used within the building input data, which is then
aggregated from hourly to daily, so that it can be merged with the hourly energy file.
In essence, the simulation I/O file(s), weather data from the specified climate zones and the hourly energy consumption file(s) are all merged to one
dataframe which is then split for training and testing purposes (training set, testing set, validation set).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are two versions of the program, one which preprocesses to only include the total energy and costing values, and one which
keeps all types of energy and costing to work with later.</p>
</div>
<p>For costing, the only preprocessing performed is on the building input files, with the weather and energy preprocessing being skipped.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The total daily energy computed for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> is converted to Megajoules per meter square (mj_per_m_sq),
which is derived by converting the total energy used provided in the simulation I/O file to Megajoules and then
dividing the result by the building floor area in meters.</p>
</div>
<p>In the case where the validation set is not provided, the dataset provided is split into a 70% training set, 20% test
set and 10% validation set. However, when a validation set is provided, the dataset is split only into a 80% training
set and 20% test set. It should be noted that the data splitting is performed using GroupShuffleSplit function which
ensures that all data instances for a <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> are included in the respective data group they are split into which
implies that a <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> used for training would not have any instance in the test set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file created at the end of preprocessing has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: This is all the features after data cleaning and preprocessing. Note that these are not the final features used for modelling.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: This contains the y_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_train</span></code>: This contains the X_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_test</span></code>: This contains the X_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: This contains the y_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test_complete</span></code>: This is similar to the y_test dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_validate</span></code>: This contains the X_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate</span></code>:  This contains the y_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate_complete</span></code>: This is similar to the y_validate dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
</ul>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="retrain.html">Train the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_model.html">Running a model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/run_model.html">Run Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/train_model_pipeline.html">Train Model Pipeline</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/usage/preprocessing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>