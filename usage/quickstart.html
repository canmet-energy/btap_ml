
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Quickstart &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Train the model" href="retrain.html" />
    <link rel="prev" title="Working on AAW" href="../aaw_setup.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>If you just want to run all of the steps from training a model to using the model to obtain predictions, here are the steps to run. You may be able to skip some
of these depending on if data has already been prepared.</p>
<p>Each of the files can use an input configuration .yml file which contains all inputs to be used alongside descriptions of the inputs.
If used, only the input file, which will be referenced as input_config.yml, will be passed when calling the training process.
Each file can also use values passed to through command line arguements. All values except the config file are optional.
Thus, the config file must still be passed, but the CLI arguements will be given priority. A mix of command line and
config files can also be used in the case where certain parts of a process should be skipped.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of the scripts for the project are in the <code class="docutils literal notranslate"><span class="pre">src/</span></code> folder of the repository. All CLI parameters can be viewed
by calling the python file with <code class="docutils literal notranslate"><span class="pre">--help</span></code> arguement (Example: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">train_model_pipeline.py</span> <span class="pre">--help</span></code>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Every file can be run independently, but the recommended steps are to run one of the two pipelines below.</p>
</div>
<section id="training-a-model">
<h2>Training a model<a class="headerlink" href="#training-a-model" title="Permalink to this headline">¶</a></h2>
<p>The first step to perform is to generate a trained Machine Learning model to later be used for obtaining predictions on energy values.
Obtaining a trained model can be performed by calling the <code class="docutils literal notranslate"><span class="pre">train_model_pipeline.py</span></code> file and passing the appropriate arguements.
Assuming that only the <code class="docutils literal notranslate"><span class="pre">input_config.yml</span></code> file is used and located inside of the current directory, the arguement to pass is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">train_model_pipeline</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>This will process the specified weather file (outputting a .parquet file), preprocess all input files (outputting a .json file and .pkl file),
perform feature selection (outputting a .json file), and train the model (outputting a .h5 trained model, two .pkl files, a .json file, and a .csv file).</p>
</section>
<section id="getting-model-predictions">
<h2>Getting model predictions<a class="headerlink" href="#getting-model-predictions" title="Permalink to this headline">¶</a></h2>
<p>With a trained Machine Learning model in the form of a .h5 file, the model will be used to obtain the predicted daily Megajoules per meter squared
and the predicted annual Gigajoules per meter squared for a batch of specified building files within a specified directory.
Obtaining a trained model can be performed by calling the <code class="docutils literal notranslate"><span class="pre">run_model.py</span></code> file and passing the appropriate arguements.
Assuming that only the <code class="docutils literal notranslate"><span class="pre">input_config.yml</span></code> file is used and located inside of the current directory, the arguement to pass is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">train_model_pipeline</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>This will process the specified weather file to be used, preprocess all input data, and obtain predictions for all input data (outputting two .csv files
which contain the prediction outputs alongside identifiers for each building in the form building_file_name/building_index).</p>
</section>
<section id="prepare-weather-data">
<h2>Prepare weather data<a class="headerlink" href="#prepare-weather-data" title="Permalink to this headline">¶</a></h2>
<p>Gather required weather data and place it on blob storage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python prepare_weather.py input_data/sample-lhs_2021-10-04.yml
</pre></div>
</div>
</section>
<section id="preprocessing">
<h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this headline">¶</a></h2>
<p>Clean the input data and split the it into test and train sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">in_build_params</span> <span class="n">input_data</span><span class="o">/</span><span class="n">output_elec_2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mf">05.</span><span class="n">xlsx</span> <span class="o">--</span><span class="n">in_hour</span> <span class="n">input_data</span><span class="o">/</span><span class="n">total_hourly_res_elec_2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mf">05.</span><span class="n">csv</span> <span class="o">--</span><span class="n">in_weather</span> <span class="n">weather</span><span class="o">/</span><span class="n">CAN_QC_Montreal</span><span class="o">-</span><span class="n">Trudeau</span><span class="o">.</span><span class="n">Intl</span><span class="o">.</span><span class="n">AP</span><span class="o">.</span><span class="mi">716270</span><span class="n">_CWEC2016</span><span class="o">.</span><span class="n">epw</span><span class="o">.</span><span class="n">parquet</span> <span class="o">--</span><span class="n">output_path</span> <span class="n">output_data</span><span class="o">/</span><span class="n">preprocessing_out</span> <span class="o">--</span><span class="n">in_build_params_gas</span> <span class="n">input_data</span><span class="o">/</span><span class="n">output_gas_2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mf">05.</span><span class="n">xlsx</span> <span class="o">--</span><span class="n">in_hour_gas</span> <span class="n">input_data</span><span class="o">/</span><span class="n">total_hourly_res_gas_2021</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mf">05.</span><span class="n">csv</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Update the input parameters to point to the appropriate input files and ouput_path in minio. Only the filenames
would need to be changed. Check <a class="reference internal" href="../api/preprocessing.html#module-preprocessing" title="preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">preprocessing</span></code></a> for full detail description of each parameter.</p>
</div>
</section>
<section id="feature-selection">
<h2>Feature Selection<a class="headerlink" href="#feature-selection" title="Permalink to this headline">¶</a></h2>
<p>After preprocessing the data, the features to be used in building the surrogate model can be selected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">in_obj_name</span> <span class="n">output_data</span><span class="o">/</span><span class="n">preprocessing_out</span> <span class="o">--</span><span class="n">output_path</span> <span class="n">output_data</span><span class="o">/</span><span class="n">feature_out</span> <span class="o">--</span><span class="n">estimator_type</span> <span class="n">lasso</span>
</pre></div>
</div>
</section>
<section id="build-surrogate-model-and-predict">
<h2>Build Surrogate Model and Predict<a class="headerlink" href="#build-surrogate-model-and-predict" title="Permalink to this headline">¶</a></h2>
<p>The output from proprocessing and feature selection are used as input into this stage by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">predict</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">param_search</span> <span class="n">no</span> <span class="o">--</span><span class="n">in_obj_name</span> <span class="n">output_data</span><span class="o">/</span><span class="n">preprocessing_out</span> <span class="o">--</span><span class="n">features</span> <span class="n">output_data</span><span class="o">/</span><span class="n">feature_out</span> <span class="o">--</span><span class="n">output_path</span> <span class="n">output_data</span><span class="o">/</span><span class="n">predict_out</span>
</pre></div>
</div>
</section>
<section id="download-results">
<h2>Download Results<a class="headerlink" href="#download-results" title="Permalink to this headline">¶</a></h2>
<p>The results from the prediction is available in minio in the output_path specified in the build step.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#training-a-model">Training a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-model-predictions">Getting model predictions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-weather-data">Prepare weather data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature-selection">Feature Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-surrogate-model-and-predict">Build Surrogate Model and Predict</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-results">Download Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="retrain.html">Train the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_model.html">Running a model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plot.html">Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/run_model.html">Run Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/train_model_pipeline.html">Train Model Pipeline</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../aaw_setup.html" title="previous chapter">Working on AAW</a></li>
      <li>Next: <a href="retrain.html" title="next chapter">Train the model</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>