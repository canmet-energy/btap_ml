
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Train the model &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Re-run Model" href="model_run.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="train-the-model">
<h1>Train the model<a class="headerlink" href="#train-the-model" title="Permalink to this headline">¶</a></h1>
<p>If there are new data files that significantly change the types of information the model knows how to predict you need
to retrain the model. This involves performing a series of steps to prepare the data and use it to retrain the model.
In the case that you want to retrain the model but are not dealing with significant changes in the data (for example,
using the same weather data) you can skip the weather data preparation or cleaning and splitting steps, as appropriate.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#preparation-of-weather-data" id="id2">Preparation of weather data</a></p></li>
<li><p><a class="reference internal" href="#clean-and-split-the-data" id="id3">Clean and split the data</a></p></li>
<li><p><a class="reference internal" href="#feature-selection" id="id4">Feature selection</a></p></li>
<li><p><a class="reference internal" href="#build-the-surrogate-model-and-predict-energy-use" id="id5">Build the surrogate model and predict energy use</a></p></li>
<li><p><a class="reference internal" href="#download-results" id="id6">Download results</a></p></li>
</ul>
</div>
<section id="preparation-of-weather-data">
<h2><a class="toc-backref" href="#id2">Preparation of weather data</a><a class="headerlink" href="#preparation-of-weather-data" title="Permalink to this headline">¶</a></h2>
<p>EnergyPlus uses weather data in the EPW file format, as defined in the <a class="reference external" href="https://energyplus.net/assets/nrel_custom/pdfs/pdfs_v9.6.0/AuxiliaryPrograms.pdf">Auxiliary
Programs</a> documentation. In
order to be consumed by the model, the data needs to undergo several steps before it can be used.</p>
<p>Weather data can be automatically preprared from the information found in the BTAP CLI configuration YAML. The
<code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> script can be used to process weather data and save it to blob storage.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python prepare_weather.py input_data/sample-lhs_2021-10-04.yml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The input to <code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> is the same configuration file that is given to BTAP CLI. The script will
look for the file on blob storage, relative to the project namespace (<code class="docutils literal notranslate"><span class="pre">nrcan-btap</span></code> on AAW).</p>
</div>
<p>Outputs are placed in the <code class="docutils literal notranslate"><span class="pre">weather</span></code> bucket (by default) in storage as parquet files. The name of the weather files
will match the input name found in the YAML file, but with a <code class="docutils literal notranslate"><span class="pre">.parquet</span></code> file extension.</p>
<section id="what-this-does">
<h3>What this does<a class="headerlink" href="#what-this-does" title="Permalink to this headline">¶</a></h3>
<p>EPW files contain several lines of data that is irrelevant to the model. This data is all in the first several lines
of the file. For example, everything before the line starting with <code class="docutils literal notranslate"><span class="pre">1966</span></code> can be ignored:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCATION</span><span class="p">,</span><span class="n">Montreal</span> <span class="n">Int</span><span class="s1">&#39;l,PQ,CAN,WYEC2-B-94792,716270,45.47,-73.75,-5.0,36.0</span>
<span class="n">DESIGN</span> <span class="n">CONDITIONS</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Climate</span> <span class="n">Design</span> <span class="n">Data</span> <span class="mi">2009</span> <span class="n">ASHRAE</span> <span class="n">Handbook</span><span class="p">,,</span><span class="n">Heating</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">23.7</span><span class="p">,</span><span class="o">-</span><span class="mf">21.1</span><span class="p">,</span><span class="o">-</span><span class="mf">30.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mi">23</span><span class="p">,</span><span class="o">-</span><span class="mf">27.9</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">20.6</span><span class="p">,</span><span class="mf">12.9</span><span class="p">,</span><span class="o">-</span><span class="mf">5.3</span><span class="p">,</span><span class="mf">11.5</span><span class="p">,</span><span class="o">-</span><span class="mf">7.9</span><span class="p">,</span><span class="mf">3.9</span><span class="p">,</span><span class="mi">260</span><span class="p">,</span><span class="n">Cooling</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">9.3</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mf">22.1</span><span class="p">,</span><span class="mf">28.5</span><span class="p">,</span><span class="mf">21.1</span><span class="p">,</span><span class="mf">27.1</span><span class="p">,</span><span class="mf">20.2</span><span class="p">,</span><span class="mf">23.2</span><span class="p">,</span><span class="mf">28.1</span><span class="p">,</span><span class="mf">22.2</span><span class="p">,</span><span class="mf">26.6</span><span class="p">,</span><span class="mf">21.4</span><span class="p">,</span><span class="mf">25.6</span><span class="p">,</span><span class="mf">4.9</span><span class="p">,</span><span class="mi">220</span><span class="p">,</span><span class="mf">21.6</span><span class="p">,</span><span class="mf">16.3</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mf">20.7</span><span class="p">,</span><span class="mf">15.5</span><span class="p">,</span><span class="mf">25.2</span><span class="p">,</span><span class="mf">19.8</span><span class="p">,</span><span class="mf">14.5</span><span class="p">,</span><span class="mf">24.2</span><span class="p">,</span><span class="mf">69.3</span><span class="p">,</span><span class="mf">28.1</span><span class="p">,</span><span class="mf">65.5</span><span class="p">,</span><span class="mf">26.7</span><span class="p">,</span><span class="mf">62.3</span><span class="p">,</span><span class="mf">25.6</span><span class="p">,</span><span class="mi">703</span><span class="p">,</span><span class="n">Extremes</span><span class="p">,</span><span class="mf">11.1</span><span class="p">,</span><span class="mf">9.7</span><span class="p">,</span><span class="mf">8.6</span><span class="p">,</span><span class="mf">27.4</span><span class="p">,</span><span class="o">-</span><span class="mf">26.5</span><span class="p">,</span><span class="mf">32.3</span><span class="p">,</span><span class="mf">2.9</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mf">28.6</span><span class="p">,</span><span class="mf">33.4</span><span class="p">,</span><span class="o">-</span><span class="mf">30.4</span><span class="p">,</span><span class="mf">34.3</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mf">35.2</span><span class="p">,</span><span class="o">-</span><span class="mf">34.2</span><span class="p">,</span><span class="mf">36.3</span>
<span class="n">TYPICAL</span><span class="o">/</span><span class="n">EXTREME</span> <span class="n">PERIODS</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">Summer</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Max</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Extreme</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span><span class="n">Summer</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span><span class="n">Winter</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Min</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Extreme</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="n">Winter</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span><span class="n">Autumn</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span><span class="n">Spring</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">4</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="o">/</span><span class="mi">18</span>
<span class="n">GROUND</span> <span class="n">TEMPERATURES</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">,,,,</span><span class="o">-</span><span class="mf">1.50</span><span class="p">,</span><span class="o">-</span><span class="mf">6.19</span><span class="p">,</span><span class="o">-</span><span class="mf">7.46</span><span class="p">,</span><span class="o">-</span><span class="mf">6.35</span><span class="p">,</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">7.05</span><span class="p">,</span><span class="mf">13.71</span><span class="p">,</span><span class="mf">18.53</span><span class="p">,</span><span class="mf">19.94</span><span class="p">,</span><span class="mf">17.67</span><span class="p">,</span><span class="mf">12.21</span><span class="p">,</span><span class="mf">5.33</span><span class="p">,</span><span class="mi">2</span><span class="p">,,,,</span><span class="mf">2.71</span><span class="p">,</span><span class="o">-</span><span class="mf">1.68</span><span class="p">,</span><span class="o">-</span><span class="mf">3.77</span><span class="p">,</span><span class="o">-</span><span class="mf">3.85</span><span class="p">,</span><span class="o">-</span><span class="mf">0.51</span><span class="p">,</span><span class="mf">4.33</span><span class="p">,</span><span class="mf">9.54</span><span class="p">,</span><span class="mf">14.01</span><span class="p">,</span><span class="mf">16.32</span><span class="p">,</span><span class="mf">15.89</span><span class="p">,</span><span class="mf">12.81</span><span class="p">,</span><span class="mf">8.08</span><span class="p">,</span><span class="mi">4</span><span class="p">,,,,</span><span class="mf">5.45</span><span class="p">,</span><span class="mf">2.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span><span class="o">-</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">0.54</span><span class="p">,</span><span class="mf">3.36</span><span class="p">,</span><span class="mf">6.87</span><span class="p">,</span><span class="mf">10.31</span><span class="p">,</span><span class="mf">12.62</span><span class="p">,</span><span class="mf">13.17</span><span class="p">,</span><span class="mf">11.85</span><span class="p">,</span><span class="mf">9.08</span>
<span class="n">HOLIDAYS</span><span class="o">/</span><span class="n">DAYLIGHT</span> <span class="n">SAVINGS</span><span class="p">,</span><span class="n">No</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<span class="n">COMMENTS</span> <span class="mi">1</span><span class="p">,</span><span class="n">WYEC2</span><span class="o">-</span><span class="n">Canadian</span> <span class="n">Weather</span> <span class="n">year</span> <span class="k">for</span> <span class="n">Energy</span> <span class="n">Calculations</span> <span class="p">(</span><span class="n">CWEC</span><span class="p">)</span> <span class="o">--</span> <span class="n">WMO</span><span class="c1">#716270</span>
<span class="n">COMMENTS</span> <span class="mi">2</span><span class="p">,</span> <span class="o">--</span> <span class="n">Ground</span> <span class="n">temps</span> <span class="n">produced</span> <span class="k">with</span> <span class="n">a</span> <span class="n">standard</span> <span class="n">soil</span> <span class="n">diffusivity</span> <span class="n">of</span> <span class="mf">2.3225760E-03</span> <span class="p">{</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">day</span><span class="p">}</span>
<span class="n">DATA</span> <span class="n">PERIODS</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="n">Sunday</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="o">/</span><span class="mi">31</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">6.8</span><span class="p">,</span><span class="mf">4.9</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">100550</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">322</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mf">7.2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">8.3</span><span class="p">,</span><span class="mf">6.2</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">100310</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">330</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mf">6.7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">9.2</span><span class="p">,</span><span class="mf">7.1</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">100170</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">335</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mf">8.1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
</pre></div>
</div>
<p>Column names for the tabular data can be found in the Auxiliary Programs documentation.</p>
<section id="remove-unused-columns">
<h4>Remove unused columns<a class="headerlink" href="#remove-unused-columns" title="Permalink to this headline">¶</a></h4>
<p>In the Auxiliary Programs documentation for the EPW file format it lists which columns in the file are actually used
for predicting building energy use. Columns marked as not used by EnergyPlus are removed from the dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">year</span></code> column is marked as not being used by EnergyPlus, but is kept for use in creating a datetime index
of the data.</p>
</div>
</section>
<section id="summarize-by-day">
<h4>Summarize by day<a class="headerlink" href="#summarize-by-day" title="Permalink to this headline">¶</a></h4>
<p>Weather data in the file is provided for every hour for all 365 days of the year. Due to the way the data is combined
in later steps, this becomes millions of records that need to be processed despite the fact that there is no intent to
predict energy use to the hourly level. To make working with the data more manageable, weather values are summarized to
daily intervals.</p>
</section>
</section>
</section>
<section id="clean-and-split-the-data">
<h2><a class="toc-backref" href="#id3">Clean and split the data</a><a class="headerlink" href="#clean-and-split-the-data" title="Permalink to this headline">¶</a></h2>
<p>With data loaded to blob storage, run <code class="docutils literal notranslate"><span class="pre">proprocessing.py</span></code> to clean and split the data into test and train sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 preprocessing.py --in_build_params input_data/output_elec_2021-11-05.xlsx --in_hour input_data/total_hourly_res_elec_2021-11-05.csv --in_weather input_data/montreal_epw.csv --output_path output_data/preprocessing_out --in_build_params_gas input_data/output_gas_2021-11-05.xlsx --in_hour_gas input_data/total_hourly_res_gas_2021-11-05.csv
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Update the input parameters to point to the appropriate input files and ouput_path in minio. Only the filenames
would need to be changed. Check <a class="reference internal" href="../api/preprocessing.html#module-preprocessing" title="preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">preprocessing</span></code></a> for full detail description of each parameter.</p>
</div>
<p>Aside from supporting optional different files for electricity and gas, if you have mutliple input files they
need to be manually combined before passing them as input. If you only have a single input file, provide it as
the value to <code class="docutils literal notranslate"><span class="pre">--in_build_params</span></code>.</p>
<section id="id1">
<h3>What this does<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>During preprocessing, the hourly energy consumption file is transposed such that each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> has 8760 rows
(365 * 24). Hence, for a simulation run containing 5000 <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code>, there would be 5000 * 8760 rows which would
be 43.8 million rows. In order to avoid the preprocessing stage to become computationally expensive due to large
datapoints created, the transposed hourly energy is is aggregated to daily energy for each datapoint_id. Similarly,
the weather information is aggregated from hourly to daily, so that it can be merged with the hourly energy file.
In essensece, the simulation I/O file(s), weather file and the hourly energy consumption file(s) are all merged to one
dataframe which then splitted for training and testing purposes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The total daily energy computed for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> is converted to Mega Joules per meter square (mj_per_m_sq),
which is derived by converting the total energy used provided in the simulation I/O file to Mega Joules and then
dividing the result by the building floor area.</p>
</div>
<p>In the case where the validation set is not provided, the dataset provided is splitted into 70% training set, 20% test
set and 10% validation set. However, when validation set is provided, the dataset is splitted only into 80% training
set and 20% test set. It should be noted that the data splitting is performed using GroupShuffleSplit function which
ensures that all data instances for a datapoint_id are included in the respective data set they are split into which
implies a datapoint_id used for training would not have any instance in the test set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file created at the end of preprocessing has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: This is all the features after data cleaning and preprocessing. Note that these are not the final features used for modelling.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: This contains the y_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_train</span></code>: This contains the X_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_test</span></code>: This contains the X_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: This contains the y_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test_complete</span></code>: This is similar to the y_test dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_validate</span></code>: This contains the X_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate</span></code>:  This contains the y_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate_complete</span></code>: This is similar to the y_validate dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
</ul>
</div>
</section>
</section>
<section id="feature-selection">
<h2><a class="toc-backref" href="#id4">Feature selection</a><a class="headerlink" href="#feature-selection" title="Permalink to this headline">¶</a></h2>
<p>After preprocessing the data, the features to be used in building the surrogate model can be selected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 feature_selection.py --in_obj_name output_data/preprocessing_out --output_path output_data/feature_out --estimator_type lasso
</pre></div>
</div>
<p>The parameters to the above script are documented in the <a class="reference internal" href="../api/feature_selection.html#module-feature_selection" title="feature_selection"><code class="xref py py-mod docutils literal notranslate"><span class="pre">feature_selection</span></code></a>.</p>
<p>In order to ensure the most relevant features are used in building the surrogage model, feature_selection is performed
to search for the most optimal features from preprocessed data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Feature selection is performed using the X_train and the y_train set.</p>
</div>
<p>Feature selection could be perfomed using either of the following estimator type listed below:</p>
<ul class="simple">
<li><p>Linear Regression</p></li>
<li><p>XGBRegressor</p></li>
<li><p>ElasticnetCV</p></li>
<li><p>LassoCV</p></li>
</ul>
<p>For the purpose of this project, XGBRegressor was often slow in selecting the features. Often times, ElasticnetCV and
LassoCV selected same features. Although, LassoCV is used as the default estimator for feature selection, any of the
other estimator type can be used by specifying the respective esimator type to the estimator_type parameter when
performing feature selection.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file created has just key value “features” which represents the final features selected for modelling.</p>
</div>
</section>
<section id="build-the-surrogate-model-and-predict-energy-use">
<h2><a class="toc-backref" href="#id5">Build the surrogate model and predict energy use</a><a class="headerlink" href="#build-the-surrogate-model-and-predict-energy-use" title="Permalink to this headline">¶</a></h2>
<p>The output from the data preparation and feature selection steps are used as input into this stage by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 predict.py --param_search yes --in_obj_name output_data/preprocessing_out --features output_data/feature_out --output_path output_data/predict_out
</pre></div>
</div>
<p>The parameters to the above script are documented in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">predict</span></code>.</p>
</section>
<section id="download-results">
<h2><a class="toc-backref" href="#id6">Download results</a><a class="headerlink" href="#download-results" title="Permalink to this headline">¶</a></h2>
<p>The results from the prediction is available in minio in the <code class="docutils literal notranslate"><span class="pre">output_path</span></code> specified in prediction step.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Train the model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preparation-of-weather-data">Preparation of weather data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clean-and-split-the-data">Clean and split the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature-selection">Feature selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-the-surrogate-model-and-predict-energy-use">Build the surrogate model and predict energy use</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-results">Download results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_run.html">Re-run Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubeflow_pipeline.html">Kubeflow pipeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plot.html">Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quickstart</a></li>
      <li>Next: <a href="model_run.html" title="next chapter">Re-run Model</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/retrain.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>