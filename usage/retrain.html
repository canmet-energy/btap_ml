
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Train the model &#8212; BTAP: ML  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running a model" href="run_model.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="train-the-model">
<h1>Train the model<a class="headerlink" href="#train-the-model" title="Permalink to this heading">¶</a></h1>
<p>If there are new data files that significantly change the types of information the model knows how to predict you need to retrain the model.
In the case that you want to retrain the model but are not dealing with significant changes in the data cleaning and splitting steps, as needed.
The steps of training a model are called inside of <code class="docutils literal notranslate"><span class="pre">train_model_pipeline.py</span></code>, but each of the individual steps performed
are also discussed below.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#training-a-model" id="id2">Training a model</a></p></li>
<li><p><a class="reference internal" href="#preparation-of-weather-data" id="id3">Preparation of weather data</a></p></li>
<li><p><a class="reference internal" href="#clean-and-split-the-data" id="id4">Clean and split the data</a></p></li>
<li><p><a class="reference internal" href="#feature-selection" id="id5">Feature selection</a></p></li>
<li><p><a class="reference internal" href="#build-the-surrogate-model-and-predict-energy-use" id="id6">Build the surrogate model and predict energy use</a></p></li>
</ul>
</nav>
<section id="training-a-model">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Training a model</a><a class="headerlink" href="#training-a-model" title="Permalink to this heading">¶</a></h2>
<p>Training a model can be done by calling the <code class="docutils literal notranslate"><span class="pre">train_model_pipeline.py</span></code> file. This file combines each
preprocessing step to allow the entire training process to be invoked from one call. The process
begins by creating a unique output directory based on the date and time which the process begins.
All outputs will be located within the new directory.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">input_config.yml</span></code> file or the passed command line arguements (which can be viewed by
passing the <code class="docutils literal notranslate"><span class="pre">--help</span></code> arguement), each required input will be validated before being used within the
program.</p>
<p>The first step performed is the processing of weather data via the <code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> file.</p>
<p>Next, the data will be passed to <code class="docutils literal notranslate"><span class="pre">preprocessing.py</span></code> to load the building data and the energy data,
and merge the two with the weather data. Following additional data cleaning, the data is split into
train/test/validation sets, where the validation set is either split from the regular input data or
is loaded from an explicitly provided file to be used for validation.</p>
<p>Before training the Machine Learning model, the optimal features will be selected by calling
<code class="docutils literal notranslate"><span class="pre">feature_selection.py</span></code>. This process will use one of several avilable tools for feature selection
to derive a list of features which will be used for training. This omits any feature which will not be
useful in the training process.</p>
<p>Using the selected features and preprocessed datasets, <code class="docutils literal notranslate"><span class="pre">predict.py</span></code> will be called to train the model.
Hyperparameter tuning can be performed at the cost of additional time complexity or the default
model architecture can be used. The trained model and test results will be output for future use.</p>
</section>
<section id="preparation-of-weather-data">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Preparation of weather data</a><a class="headerlink" href="#preparation-of-weather-data" title="Permalink to this heading">¶</a></h2>
<p>EnergyPlus uses weather data in the EPW file format, as defined in the <a class="reference external" href="https://energyplus.net/assets/nrel_custom/pdfs/pdfs_v9.6.0/AuxiliaryPrograms.pdf">Auxiliary
Programs</a> documentation. In
order to be consumed by the model, the data needs to undergo several steps before it can be used.</p>
<p>The weather data is received from a <a class="reference external" href="https://raw.githubusercontent.com/NREL/openstudio-standards/nrcan/data/weather/">GitHub repo</a>.</p>
<p>Weather data can be automatically preprared from the information found in the input building .xlsx files. The
<code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> script can be used to process and save weather data.</p>
<p>Although <code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> can be used to process the weather files directly, within the training and
running pipelines, the weather is processed as part of the data preprocessing step by loading all weather
files attached to buildings in the input file(s). The contents of this subsection outline how the weather data
is processed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">prepare_weather</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The input to <code class="docutils literal notranslate"><span class="pre">prepare_weather.py</span></code> is the same configuration file that is given to <code class="docutils literal notranslate"><span class="pre">train_model_pipeline.py</span></code>
and to <code class="docutils literal notranslate"><span class="pre">run_model.py</span></code>. The CLI can also be used to invoke the process without a complete configuration file.
The weather files to process must now be passed through the CLI since it is no longer an input in the
configuration file.</p>
</div>
<p>Outputs are placed into a <code class="docutils literal notranslate"><span class="pre">/weather</span></code> folder (by default) in storage as parquet files. The name of the weather files
will match the input name found in the YAML file, but with a <code class="docutils literal notranslate"><span class="pre">.parquet</span></code> file extension.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When called within the data preprocessing step, no <code class="docutils literal notranslate"><span class="pre">.parquet</span></code> file is output. The output is directly used without
needing to be loaded again.</p>
</div>
<section id="what-this-does">
<h3>What this does<a class="headerlink" href="#what-this-does" title="Permalink to this heading">¶</a></h3>
<p>EPW files contain several lines of data that is irrelevant to the model. This data is all in the first several lines
of the file. For example, everything before the line starting with <code class="docutils literal notranslate"><span class="pre">1966</span></code> can be ignored:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCATION</span><span class="p">,</span><span class="n">Montreal</span> <span class="n">Int</span><span class="s1">&#39;l,PQ,CAN,WYEC2-B-94792,716270,45.47,-73.75,-5.0,36.0</span>
<span class="n">DESIGN</span> <span class="n">CONDITIONS</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Climate</span> <span class="n">Design</span> <span class="n">Data</span> <span class="mi">2009</span> <span class="n">ASHRAE</span> <span class="n">Handbook</span><span class="p">,,</span><span class="n">Heating</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">23.7</span><span class="p">,</span><span class="o">-</span><span class="mf">21.1</span><span class="p">,</span><span class="o">-</span><span class="mf">30.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mi">23</span><span class="p">,</span><span class="o">-</span><span class="mf">27.9</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mf">20.6</span><span class="p">,</span><span class="mf">12.9</span><span class="p">,</span><span class="o">-</span><span class="mf">5.3</span><span class="p">,</span><span class="mf">11.5</span><span class="p">,</span><span class="o">-</span><span class="mf">7.9</span><span class="p">,</span><span class="mf">3.9</span><span class="p">,</span><span class="mi">260</span><span class="p">,</span><span class="n">Cooling</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">9.3</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mf">22.1</span><span class="p">,</span><span class="mf">28.5</span><span class="p">,</span><span class="mf">21.1</span><span class="p">,</span><span class="mf">27.1</span><span class="p">,</span><span class="mf">20.2</span><span class="p">,</span><span class="mf">23.2</span><span class="p">,</span><span class="mf">28.1</span><span class="p">,</span><span class="mf">22.2</span><span class="p">,</span><span class="mf">26.6</span><span class="p">,</span><span class="mf">21.4</span><span class="p">,</span><span class="mf">25.6</span><span class="p">,</span><span class="mf">4.9</span><span class="p">,</span><span class="mi">220</span><span class="p">,</span><span class="mf">21.6</span><span class="p">,</span><span class="mf">16.3</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mf">20.7</span><span class="p">,</span><span class="mf">15.5</span><span class="p">,</span><span class="mf">25.2</span><span class="p">,</span><span class="mf">19.8</span><span class="p">,</span><span class="mf">14.5</span><span class="p">,</span><span class="mf">24.2</span><span class="p">,</span><span class="mf">69.3</span><span class="p">,</span><span class="mf">28.1</span><span class="p">,</span><span class="mf">65.5</span><span class="p">,</span><span class="mf">26.7</span><span class="p">,</span><span class="mf">62.3</span><span class="p">,</span><span class="mf">25.6</span><span class="p">,</span><span class="mi">703</span><span class="p">,</span><span class="n">Extremes</span><span class="p">,</span><span class="mf">11.1</span><span class="p">,</span><span class="mf">9.7</span><span class="p">,</span><span class="mf">8.6</span><span class="p">,</span><span class="mf">27.4</span><span class="p">,</span><span class="o">-</span><span class="mf">26.5</span><span class="p">,</span><span class="mf">32.3</span><span class="p">,</span><span class="mf">2.9</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="o">-</span><span class="mf">28.6</span><span class="p">,</span><span class="mf">33.4</span><span class="p">,</span><span class="o">-</span><span class="mf">30.4</span><span class="p">,</span><span class="mf">34.3</span><span class="p">,</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mf">35.2</span><span class="p">,</span><span class="o">-</span><span class="mf">34.2</span><span class="p">,</span><span class="mf">36.3</span>
<span class="n">TYPICAL</span><span class="o">/</span><span class="n">EXTREME</span> <span class="n">PERIODS</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">Summer</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Max</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Extreme</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span><span class="n">Summer</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span> <span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span><span class="n">Winter</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Min</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Extreme</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span> <span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="n">Winter</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="mi">17</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="mi">23</span><span class="p">,</span><span class="n">Autumn</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">19</span><span class="p">,</span><span class="n">Spring</span> <span class="o">-</span> <span class="n">Week</span> <span class="n">Nearest</span> <span class="n">Average</span> <span class="n">Temperature</span> <span class="n">For</span> <span class="n">Period</span><span class="p">,</span><span class="n">Typical</span><span class="p">,</span><span class="mi">4</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="o">/</span><span class="mi">18</span>
<span class="n">GROUND</span> <span class="n">TEMPERATURES</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">.5</span><span class="p">,,,,</span><span class="o">-</span><span class="mf">1.50</span><span class="p">,</span><span class="o">-</span><span class="mf">6.19</span><span class="p">,</span><span class="o">-</span><span class="mf">7.46</span><span class="p">,</span><span class="o">-</span><span class="mf">6.35</span><span class="p">,</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">7.05</span><span class="p">,</span><span class="mf">13.71</span><span class="p">,</span><span class="mf">18.53</span><span class="p">,</span><span class="mf">19.94</span><span class="p">,</span><span class="mf">17.67</span><span class="p">,</span><span class="mf">12.21</span><span class="p">,</span><span class="mf">5.33</span><span class="p">,</span><span class="mi">2</span><span class="p">,,,,</span><span class="mf">2.71</span><span class="p">,</span><span class="o">-</span><span class="mf">1.68</span><span class="p">,</span><span class="o">-</span><span class="mf">3.77</span><span class="p">,</span><span class="o">-</span><span class="mf">3.85</span><span class="p">,</span><span class="o">-</span><span class="mf">0.51</span><span class="p">,</span><span class="mf">4.33</span><span class="p">,</span><span class="mf">9.54</span><span class="p">,</span><span class="mf">14.01</span><span class="p">,</span><span class="mf">16.32</span><span class="p">,</span><span class="mf">15.89</span><span class="p">,</span><span class="mf">12.81</span><span class="p">,</span><span class="mf">8.08</span><span class="p">,</span><span class="mi">4</span><span class="p">,,,,</span><span class="mf">5.45</span><span class="p">,</span><span class="mf">2.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span><span class="o">-</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">0.54</span><span class="p">,</span><span class="mf">3.36</span><span class="p">,</span><span class="mf">6.87</span><span class="p">,</span><span class="mf">10.31</span><span class="p">,</span><span class="mf">12.62</span><span class="p">,</span><span class="mf">13.17</span><span class="p">,</span><span class="mf">11.85</span><span class="p">,</span><span class="mf">9.08</span>
<span class="n">HOLIDAYS</span><span class="o">/</span><span class="n">DAYLIGHT</span> <span class="n">SAVINGS</span><span class="p">,</span><span class="n">No</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<span class="n">COMMENTS</span> <span class="mi">1</span><span class="p">,</span><span class="n">WYEC2</span><span class="o">-</span><span class="n">Canadian</span> <span class="n">Weather</span> <span class="n">year</span> <span class="k">for</span> <span class="n">Energy</span> <span class="n">Calculations</span> <span class="p">(</span><span class="n">CWEC</span><span class="p">)</span> <span class="o">--</span> <span class="n">WMO</span><span class="c1">#716270</span>
<span class="n">COMMENTS</span> <span class="mi">2</span><span class="p">,</span> <span class="o">--</span> <span class="n">Ground</span> <span class="n">temps</span> <span class="n">produced</span> <span class="k">with</span> <span class="n">a</span> <span class="n">standard</span> <span class="n">soil</span> <span class="n">diffusivity</span> <span class="n">of</span> <span class="mf">2.3225760E-03</span> <span class="p">{</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">day</span><span class="p">}</span>
<span class="n">DATA</span> <span class="n">PERIODS</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="n">Sunday</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="o">/</span><span class="mi">31</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">6.8</span><span class="p">,</span><span class="mf">4.9</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">100550</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">322</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mf">7.2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">8.3</span><span class="p">,</span><span class="mf">6.2</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">100310</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">330</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mf">6.7</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
<span class="mi">1966</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="n">A_A__</span><span class="o">*</span><span class="n">A_9</span><span class="o">*</span><span class="n">M_Q_M_Q_Q_Q_9_____________</span><span class="o">*</span><span class="n">_</span><span class="o">*</span><span class="n">___</span><span class="o">*</span><span class="p">,</span><span class="mf">9.2</span><span class="p">,</span><span class="mf">7.1</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">100170</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">,</span><span class="mi">335</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999900</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mf">8.1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">16.1</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999999</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span>
</pre></div>
</div>
<p>Column names for the tabular data can be found in the Auxiliary Programs documentation.</p>
<section id="remove-unused-columns">
<h4>Remove unused columns<a class="headerlink" href="#remove-unused-columns" title="Permalink to this heading">¶</a></h4>
<p>In the Auxiliary Programs documentation for the EPW file format it lists which columns in the file are actually used
for predicting building energy use. Columns marked as not used by EnergyPlus are removed from the dataset.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">year</span></code> column is marked as not being used by EnergyPlus, but is kept for use in creating a datetime index
of the data. Only the month and day values are used when merging with building and energy data.</p>
</div>
</section>
<section id="summarize-by-day">
<h4>Summarize by day<a class="headerlink" href="#summarize-by-day" title="Permalink to this heading">¶</a></h4>
<p>Weather data in the file is provided for every hour for all 365 days of the year. Due to the way the data is combined
in later steps, this becomes millions of records that need to be processed despite the fact that there is no intent to
predict energy use to the hourly level. To make working with the data more manageable, weather values are summarized to
daily intervals.</p>
</section>
</section>
</section>
<section id="clean-and-split-the-data">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Clean and split the data</a><a class="headerlink" href="#clean-and-split-the-data" title="Permalink to this heading">¶</a></h2>
<p>With the inputs specified through the command line or through <code class="docutils literal notranslate"><span class="pre">input_config.py</span></code>,
run <code class="docutils literal notranslate"><span class="pre">proprocessing.py</span></code> to clean and split the data into train, test, and validation sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Update the input parameters to point to the appropriate input files.
Check <a class="reference internal" href="../api/preprocessing.html#module-preprocessing" title="preprocessing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">preprocessing</span></code></a> for full detail description of each parameter.</p>
</div>
<p>Aside from supporting optional files for electricity and gas, if you have mutliple input files to combine, they
need to be manually combined before passing them as input.</p>
<section id="id1">
<h3>What this does<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>During preprocessing, the hourly energy consumption file is transposed such that each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> has 8760 rows
(365 * 24). Hence, for a simulation run containing 5000 <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> values, there would be 5000 * 8760 rows which would
be 43.8 million rows. In order to avoid the preprocessing stage to become computationally expensive due to large
datapoints created, the transposed hourly energy file is aggregated to daily energy for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code>. Similarly,
the weather information is loaded based on which climate zones are used within the building input data, which is then
aggregated from hourly to daily, so that it can be merged with the hourly energy file.
In essence, the simulation I/O file(s), weather data from the specified climate zones and the hourly energy consumption file(s) are all merged to one
dataframe which is then split for training and testing purposes (training set, testing set, validation set).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The total daily energy computed for each <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> is converted to Megajoules per meter square (mj_per_m_sq),
which is derived by converting the total energy used provided in the simulation I/O file to Megajoules and then
dividing the result by the building floor area in meters.</p>
</div>
<p>In the case where the validation set is not provided, the dataset provided is split into a 70% training set, 20% test
set and 10% validation set. However, when a validation set is provided, the dataset is split only into a 80% training
set and 20% test set. It should be noted that the data splitting is performed using GroupShuffleSplit function which
ensures that all data instances for a <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> are included in the respective data group they are split into which
implies that a <code class="docutils literal notranslate"><span class="pre">datapoint_id</span></code> used for training would not have any instance in the test set.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file created at the end of preprocessing has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code>: This is all the features after data cleaning and preprocessing. Note that these are not the final features used for modelling.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_train</span></code>: This contains the y_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_train</span></code>: This contains the X_train dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_test</span></code>: This contains the X_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test</span></code>: This contains the y_test dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_test_complete</span></code>: This is similar to the y_test dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X_validate</span></code>: This contains the X_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate</span></code>:  This contains the y_validate dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_validate_complete</span></code>: This is similar to the y_validate dataset, but has the additional column datapoint_id which would be used needed in creating the final output file after predict.py is run.</p></li>
</ul>
</div>
</section>
</section>
<section id="feature-selection">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Feature selection</a><a class="headerlink" href="#feature-selection" title="Permalink to this heading">¶</a></h2>
<p>After preprocessing the data, the features to be used in building the surrogate model can be selected
(with all inputs coming from the command line or from the <code class="docutils literal notranslate"><span class="pre">input_config.yml</span></code> file):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>The parameters to the above script are documented at <a class="reference internal" href="../api/feature_selection.html#module-feature_selection" title="feature_selection"><code class="xref py py-mod docutils literal notranslate"><span class="pre">feature_selection</span></code></a>.</p>
<p>To ensure that the most relevant features are used in building the surrogage model, feature selection is performed
to search for the most optimal features from the preprocessed data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Feature selection is performed using the X_train and the y_train set.</p>
</div>
<p>Feature selection can be perfomed using any of the following estimator types:</p>
<ul class="simple">
<li><p>Linear Regression</p></li>
<li><p>XGBRegressor</p></li>
<li><p>ElasticnetCV</p></li>
<li><p>LassoCV</p></li>
</ul>
<p>Some details on the options are:</p>
<ul class="simple">
<li><p>XGBRegressor and ElasticnetCV are often slow in selecting the features.</p></li>
<li><p>ElasticnetCV and LassoCV frequently selected same features.</p></li>
<li><p>Although, LassoCV is used as the default estimator for feature selection, any of the other estimator type can be used by specifying the respective esimator type to the estimator_type parameter when performing feature selection.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The json file that is created contains the key value “features” which represents the final features selected for modelling.</p>
</div>
</section>
<section id="build-the-surrogate-model-and-predict-energy-use">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Build the surrogate model and predict energy use</a><a class="headerlink" href="#build-the-surrogate-model-and-predict-energy-use" title="Permalink to this heading">¶</a></h2>
<p>The output from the preprocessing and feature selection outputs are used as input to <code class="docutils literal notranslate"><span class="pre">predict.py</span></code>
to derive a trained model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">predict</span><span class="o">.</span><span class="n">py</span> <span class="n">input_config</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>This script will output the trained model as a .h5 file alongisde information on the training and testing
performed for analysis. The outputs from this step will be used when obtaining predictions with the model.</p>
<p>The parameters to the above script are documented at: <a class="reference internal" href="../api/predict.html#module-predict" title="predict"><code class="xref py py-mod docutils literal notranslate"><span class="pre">predict</span></code></a>.</p>
<p>The Machine Learning model which is used for training will vary depending on whether parameter tuning is or is not
performed. When used, the <a class="reference external" href="https://keras.io/api/keras_tuner/tuners/hyperband/">Keras Hyperband Tuner</a> is configured
to optimize the parameters based on the loss. The tuner also uses early stopping by monitoring the loss with a
patience of 5. Once the tuner finishes, the optimized model is built and used for training.</p>
<p>If hyperparameter tuning is not performed, the default model which has been evaluated as a baseline for performance is used. This model uses a dense layer of 56 nodes with the ReLU activation function and a dropout layer of 10% applied afterwards. The adam optimizer is used with a learning rate of 0.001.</p>
<p>A customized RMSE loss function is defined and used for training which takes a sum of the labels and predictions before computing the RMSE loss.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">BTAP: ML</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html">Working on AAW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aaw_setup.html#project-source-code">Project source code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Train the model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#training-a-model">Training a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation-of-weather-data">Preparation of weather data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clean-and-split-the-data">Clean and split the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#feature-selection">Feature selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-the-surrogate-model-and-predict-energy-use">Build the surrogate model and predict energy use</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run_model.html">Running a model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature_selection.html">Feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plot.html">Plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/predict.html">Predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/prepare_weather.html">Prepare weather</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/run_model.html">Run Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/train_model_pipeline.html">Train Model Pipeline</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quickstart</a></li>
      <li>Next: <a href="run_model.html" title="next chapter">Running a model</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Natural Resources Canada.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/retrain.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>